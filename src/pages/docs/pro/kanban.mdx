import { CodeComponent } from '@/components/code.component'
import DocsLayout from '@/layouts/docs.layout'
import ComponentLayout from '@/layouts/component.layout'
import { Button, FIBin, FIX, Icon, MenuProvider, Portal, Text, View, useDialog } from '@fold-dev/core'
import React, { useState } from 'react'
import {
    Detail,
    Kanban,
    KanbanColumnMenu,
    KanbanSelection,
    KanbanSwimlaneMenu,
    KanbanTypes,
    LabelMenu,
    Popup,
    UserMenu,
    dispatchKanbanEvent,
    dispatchTodoEvent,
    kanbanState,
} from '@fold-pro/react'
import * as data from '@/dummy-data'

export const docs = {"title":"Kanban Board","subtitle":"Streamline workflows with a the ever popoular Kanban Board component.","description":"The Kanban Board component is designed to be highly customizable, with great UX. Organise work in multiple levels with swimlanes being supported out of the box.","pro":true}

export const props = [{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanAddCard","methods":[],"props":{"onAdd":{"defaultValue":null,"description":"","name":"onAdd","declarations":[{"fileName":"pro/src/kanban/kanban-add-card.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"any"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanAddColumn","methods":[],"props":{"onAdd":{"defaultValue":null,"description":"","name":"onAdd","declarations":[{"fileName":"pro/src/kanban/kanban-add-column.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"any"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanImage","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanCardMenuButton","methods":[],"props":{"onMenuClick":{"defaultValue":null,"description":"","name":"onMenuClick","declarations":[{"fileName":"pro/src/kanban/kanban-card.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"(e: any) => void"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanCard","methods":[],"props":{"index":{"defaultValue":null,"description":"","name":"index","declarations":[{"fileName":"pro/src/kanban/kanban-card.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"number"},"tags":{}},"areaId":{"defaultValue":null,"description":"","name":"areaId","declarations":[{"fileName":"pro/src/kanban/kanban-card.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"string"},"tags":{}},"selected":{"defaultValue":null,"description":"","name":"selected","declarations":[{"fileName":"pro/src/kanban/kanban-card.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"boolean"},"tags":{}},"onUpdate":{"defaultValue":null,"description":"","name":"onUpdate","declarations":[{"fileName":"pro/src/kanban/kanban-card.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"(card: any) => void"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanColumnHeader","methods":[],"props":{"id":{"defaultValue":null,"description":"","name":"id","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"string"},"tags":{}},"name":{"defaultValue":null,"description":"","name":"name","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"string"},"tags":{}},"prefix":{"defaultValue":null,"description":"","name":"prefix","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"ReactElement<any, string | JSXElementConstructor<any>>"},"tags":{}},"description":{"defaultValue":null,"description":"","name":"description","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"string"},"tags":{}},"color":{"defaultValue":null,"description":"","name":"color","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"string"},"tags":{}},"cards":{"defaultValue":null,"description":"","name":"cards","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"number"},"tags":{}},"collapsed":{"defaultValue":null,"description":"","name":"collapsed","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"boolean"},"tags":{}},"collapsible":{"defaultValue":null,"description":"","name":"collapsible","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"boolean"},"tags":{}},"onCollapseToggle":{"defaultValue":null,"description":"","name":"onCollapseToggle","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"any"},"tags":{}},"editableName":{"defaultValue":null,"description":"","name":"editableName","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"boolean"},"tags":{}},"cardCount":{"defaultValue":null,"description":"","name":"cardCount","declarations":[{"fileName":"pro/src/kanban/kanban-column-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"boolean"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanColumnMenu","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanColumn","methods":[],"props":{"swimlaneIndex":{"defaultValue":null,"description":"","name":"swimlaneIndex","declarations":[{"fileName":"pro/src/kanban/kanban-column.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"number"},"tags":{}},"index":{"defaultValue":null,"description":"","name":"index","declarations":[{"fileName":"pro/src/kanban/kanban-column.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"number"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanColumns","methods":[],"props":{"linedColumnDrag":{"defaultValue":null,"description":"","name":"linedColumnDrag","declarations":[{"fileName":"pro/src/kanban/kanban-columns.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"boolean"},"tags":{}},"columns":{"defaultValue":null,"description":"","name":"columns","declarations":[{"fileName":"pro/src/kanban/kanban-columns.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"Column[]"},"tags":{}},"swimlaneId":{"defaultValue":null,"description":"","name":"swimlaneId","declarations":[{"fileName":"pro/src/kanban/kanban-columns.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"string"},"tags":{}},"swimlaneIndex":{"defaultValue":null,"description":"","name":"swimlaneIndex","declarations":[{"fileName":"pro/src/kanban/kanban-columns.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"number"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanSwimlaneHeader","methods":[],"props":{"color":{"defaultValue":null,"description":"","name":"color","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"string"},"tags":{}},"title":{"defaultValue":null,"description":"","name":"title","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"string"},"tags":{}},"description":{"defaultValue":null,"description":"","name":"description","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"string"},"tags":{}},"prefix":{"defaultValue":null,"description":"","name":"prefix","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"ReactElement<any, string | JSXElementConstructor<any>>"},"tags":{}},"collapsed":{"defaultValue":null,"description":"","name":"collapsed","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"boolean"},"tags":{}},"onCollapse":{"defaultValue":null,"description":"","name":"onCollapse","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"any"},"tags":{}},"onTitleChange":{"defaultValue":null,"description":"","name":"onTitleChange","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"any"},"tags":{}},"onMenuClick":{"defaultValue":null,"description":"","name":"onMenuClick","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane-header.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"any"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanSwimlaneMenu","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanSwimlane","methods":[],"props":{"index":{"defaultValue":null,"description":"","name":"index","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"number"},"tags":{}},"linedColumnDrag":{"defaultValue":null,"description":"","name":"linedColumnDrag","declarations":[{"fileName":"pro/src/kanban/kanban-swimlane.tsx","name":"TypeLiteral"}],"required":false,"type":{"name":"boolean"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanSwimlanes","methods":[],"props":{"swimlanes":{"defaultValue":null,"description":"","name":"swimlanes","declarations":[{"fileName":"pro/src/kanban/kanban-swimlanes.tsx","name":"TypeLiteral"}],"required":true,"type":{"name":"Swimlane[]"},"tags":{}}}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanProvider","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"KanbanComponent","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"Kanban","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"Get the column & swimlane index from the id","displayName":"getColumnAndSwimlaneIndex","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"getCustomColumnGhostElement","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"getCustomSwimlaneGhostElement","methods":[],"props":{}},{"tags":{},"filePath":"src/kanban/index.ts","description":"","displayName":"kanbanState","methods":[],"props":{}}]

export const css = [[["--f-kanban-padding","10px"],["--f-kanban-background","var(--f-color-surface)"],["--f-kanban-add-background","transparent"],["--f-kanban-drag-opacity","1"]],[["--f-kanban-swimlane-minheight","100%"],["--f-kanban-swimlane-color","var(--f-color-text-weak)"],["--f-kanban-swimlane-color-background","var(--f-color-surface-stronger)"],["--f-kanban-swimlane-border-radius","var(--f-radius)"],["--f-kanban-swimlane-border","1px solid var(--f-color-border)"],["--f-kanban-swimlane-padding","var(--f-space-4)"],["--f-kanban-swimlane-collapse-icon-width","3px"],["--f-kanban-swimlane-gap","4px"]],[["--f-kanban-column-header-padding","0 3px"],["--f-kanban-column-width","300px"],["--f-kanban-column-border","1px solid var(--f-color-border)"],["--f-kanban-column-outer-padding","0 2px"],["--f-kanban-column-padding","14px 7px 7px 7px"],["--f-kanban-column-background"," var(--f-color-surface-strong)"],["--f-kanban-column-background-hover","var(--f-color-surface-stronger)"],["--f-kanban-column-header-spacing","7px"],["--f-kanban-column-header-color","var(--f-color-text-weak)"],["--f-kanban-column-description-color","var(--f-color-text-weaker)"],["--f-kanban-column-footer-padding","4px 0 0 0"],["--f-kanban-column-footer-background","var(--f-color-surface-strong)"],["--f-kanban-column-radius","var(--f-radius)"],["--f-kanban-column-header-font-size","16px"],["--f-kanban-column-header-line-height","20px"],["--f-kanban-column-header-description-font-size","12px"],["--f-kanban-column-header-description-line-height","14px"],["--f-kanban-column-header-pill-height","22px"],["--f-kanban-column-header-pill-font-size","12px"],["--f-kanban-column-header-pill-line-height","14px"]],[["--f-kanban-column-placeholder-radius","var(--f-radius)"]],[["--f-kanban-add-column-margin","2px 20px 0px 5px"]],[["--f-kanban-card-background","var(--f-color-surface)"],["--f-kanban-card-bottom-border","0px"],["--f-kanban-card-border","var(--f-kanban-card-bottom-border) solid var(--f-color-border)"],["--f-kanban-card-border-hover","2px solid var(--f-color-border)"],["--f-kanban-card-radius","var(--f-radius)"],["--f-kanban-card-spacing-bottom","4px"],["--f-kanban-card-padding","12px"],["--f-kanban-card-image-padding","0"],["--f-kanban-card-content-gap","var(--f-size-2)"],["--f-kanban-card-text-padding","0"],["--f-kanban-card-gap","10px"],["--f-kanban-card-panel-padding","0"],["--f-kanban-card-panel-gap","5px"],["--f-kanban-card-color-size","3px"],["--f-kanban-card-select-color","var(--f-color-accent)"],["--f-kanban-card-select-width","2px"]],[["--f-kanban-text-size","14px"],["--f-kanban-line-height","20px"],["--f-kanban-text-color","var(--f-color-text)"],["--f-kanban-text-color-complete","var(--f-color-text-weakest)"],["--f-kanban-date-text-size","12px"],["--f-kanban-date-line-height","14px"]],[["--f-kanban-card-menu-background","var(--f-color-surface)"],["--f-kanban-card-menu-x","5px"],["--f-kanban-card-menu-y","5px"],["--f-kanban-card-menu-hover","var(--f-color-surface-strong)"],["--f-kanban-card-menu-color","var(--f-color-text-weaker)"]]]



<CodeComponent filename="kanban.tsx" code="aW1wb3J0IHsKICBLYW5iYW5BZGRDYXJkLAogIEthbmJhbkFkZENvbHVtbiwKICBLYW5iYW5JbWFnZSwKICBLYW5iYW5DYXJkTWVudUJ1dHRvbiwKICBLYW5iYW5DYXJkLAogIEthbmJhbkNvbHVtbkhlYWRlciwKICBLYW5iYW5Db2x1bW5NZW51LAogIEthbmJhbkNvbHVtbiwKICBLYW5iYW5Db2x1bW5zLAogIEthbmJhblN3aW1sYW5lSGVhZGVyLAogIEthbmJhblN3aW1sYW5lTWVudSwKICBLYW5iYW5Td2ltbGFuZSwKICBLYW5iYW5Td2ltbGFuZXMsCiAgS2FuYmFuUHJvdmlkZXIsCiAgS2FuYmFuQ29tcG9uZW50LAogIEthbmJhbiwKICBnZXRDb2x1bW5BbmRTd2ltbGFuZUluZGV4LAogIGdldEN1c3RvbUNvbHVtbkdob3N0RWxlbWVudCwKICBnZXRDdXN0b21Td2ltbGFuZUdob3N0RWxlbWVudCwKICBrYW5iYW5TdGF0ZSwKfSBmcm9tICJAZm9sZC1kZXYvY29yZSI7Cg==" />
```tsx
import {
  KanbanAddCard,
  KanbanAddColumn,
  KanbanImage,
  KanbanCardMenuButton,
  KanbanCard,
  KanbanColumnHeader,
  KanbanColumnMenu,
  KanbanColumn,
  KanbanColumns,
  KanbanSwimlaneHeader,
  KanbanSwimlaneMenu,
  KanbanSwimlane,
  KanbanSwimlanes,
  KanbanProvider,
  KanbanComponent,
  Kanban,
  getColumnAndSwimlaneIndex,
  getCustomColumnGhostElement,
  getCustomSwimlaneGhostElement,
  kanbanState,
} from "@fold-dev/core";
```

### Usage

export const Usage = () => {
    const [swimlanes, setSwimlanes] = useState([data.swimlanes[0]]);
    const [card, setCard] = useState({});
    const { setDialog, closeDialog } = useDialog();
    const handleCardMove = ({ origin, target }, selection) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardMove({ origin, target }, selection);
    };
    const handleColumnMove = ({ origin, target }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnMove({ origin, target });
    };
    const handleSwimlaneMove = ({ origin, target }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleSwimlaneMove({ origin, target });
    };
    const handleCardOpen = (card) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardOpen(card);
    };
    const handleCardAdd = ({ value, swimlaneIndex, columnIndex }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardAdd({ value, swimlaneIndex, columnIndex });
    };
    const handleCardUpdate = (ca) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardUpdate(ca);
    };
    const handleCardDelete = (ca) => {
        setDialog({
            title: 'Are you sure?',
            description: 'This action cannot be undone.',
            footer: (<View row width="100%" justifyContent="space-between">
                    <Button onClick={closeDialog}>Cancel</Button>
                    <Button onClick={() => {
                    kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardDelete(ca);
                    closeDialog();
                }} variant="danger">
                        Delete
                    </Button>
                </View>),
        });
    };
    const handleColumnAdd = ({ value, swimlaneIndex }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnAdd({ value, swimlaneIndex });
    };
    const handleColumnUpdate = (col) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnUpdate(col);
    };
    const handleColumnDelete = (col) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnDelete(col);
    };
    const handleSwimlaneUpdate = (sl) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleSwimlaneUpdate(sl);
    };
    const handleSwimlaneDelete = (sl) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleSwimlaneDelete(sl);
    };
    const getMenu = ({ data: { target, payload }, dismiss }) => {
        switch (target) {
            case 'kanban-label':
                return (<LabelMenu onFilter={(value) => console.log('filter', value)} availableLabels={data.availableLabels} labels={payload.labels} onCancel={dismiss} onSave={(labels) => {
                        handleCardUpdate({ ...payload, labels });
                        dismiss();
                    }}/>);
            case 'kanban-user':
                return (<UserMenu onFilter={(value) => console.log('filter', value)} availableUsers={data.availableUsers} users={payload.users} onCancel={dismiss} onSave={(users) => {
                        handleCardUpdate({ ...payload, users });
                        dismiss();
                    }}/>);
            case 'kanban-menu':
                return (<Popup colorPalette={data.colorPalette} item={payload} onCancel={dismiss} onSave={(card) => {
                        dismiss();
                        handleCardUpdate({ ...payload, ...card });
                    }} onView={() => {
                        dismiss();
                        setCard(payload);
                    }} onDelete={() => {
                        dismiss();
                        handleCardDelete(payload);
                    }}/>);
            case 'kanban-column':
                return (<KanbanColumnMenu colorPalette={data.colorPalette} onSave={(column) => {
                        handleColumnUpdate({ ...payload, ...column });
                        dismiss();
                    }} onDelete={() => {
                        handleColumnDelete(payload);
                        dismiss();
                    }} column={payload}/>);
            case 'kanban-swimlane':
                return (<KanbanSwimlaneMenu colorPalette={data.colorPalette} onSave={(swimlane) => {
                        handleSwimlaneUpdate({ ...payload, ...swimlane });
                        dismiss();
                    }} onDelete={() => {
                        handleSwimlaneDelete(payload);
                        dismiss();
                    }} swimlane={payload}/>);
            default:
                return null;
        }
    };
    return (<View width="100%" height={700}>
            {!!card.id && (<Detail colorPalette={data.colorPalette} availableLabels={data.availableLabels} availableUsers={data.availableUsers} item={card} onCancel={() => setCard({})} onSave={(card) => {
                handleCardUpdate(card);
                setCard({});
            }} onDelete={(card) => {
                handleCardDelete(card);
                setCard({});
            }}/>)}

            <MenuProvider menu={getMenu}>
                <Kanban id="kanban-instance-1" style={{ '--f-kanban-swimlane-minheight': '100%' }} swimlanes={swimlanes} onCardOpen={handleCardOpen} onCardAdd={handleCardAdd} onCardUpdate={handleCardUpdate} onCardMove={handleCardMove} onColumnAdd={handleColumnAdd} onColumnMove={handleColumnMove} onSwimlaneMove={handleSwimlaneMove} onColumnUpdate={handleColumnUpdate} onSwimlaneUpdate={handleSwimlaneUpdate} defaultInteraction="animated" targetVariant={{ 'projects': 'focus' }} card={undefined} columnHeader={undefined} swimlaneHeader={undefined} toolbar={({ selection }) => {
            return (<View row position="fixed" bgToken="surface-inverse" colorToken="text-on-color" p="1rem 2rem" radius="var(--f-radius)" shadow="var(--f-shadow-xl)" zIndex={1000} gap={10} className="f-fadein" display={!Object.keys(selection).length ? 'none' : 'flex'} style={{ bottom: 10, left: '50%', transform: 'translateX(-50%)' }}>
                                <Text color="inherit">{Object.keys(selection).length} selected</Text>
                                <Icon icon={FIBin} className="f-buttonize" onClick={() => {
                    setDialog({
                        title: 'Are you sure?',
                        description: 'This action cannot be undone.',
                        portal: Portal,
                        footer: (<View width="100%" row justifyContent="space-between">
                                                    <Button onClick={() => {
                                closeDialog();
                                dispatchKanbanEvent('select', {
                                    instanceId: 'kanban-instance-1',
                                });
                            }}>
                                                        Cancel
                                                    </Button>
                                                    <Button variant="danger" onClick={() => {
                                kanbanState({
                                    swimlanes,
                                    setSwimlanes,
                                    card,
                                    setCard,
                                }).handleSelectionDelete(selection);
                                dispatchKanbanEvent('select', {
                                    instanceId: 'kanban-instance-1',
                                });
                                closeDialog();
                            }}>
                                                        Delete
                                                    </Button>
                                                </View>),
                    });
                }}/>
                            </View>);
        }}/>
            </MenuProvider>
        </View>);
};

<div className="story-block">
<Usage />
</div>

<CodeComponent filename="BasicUsage.tsx" code="ZXhwb3J0IGNvbnN0IFVzYWdlID0gKCkgPT4gewogICAgY29uc3QgW3N3aW1sYW5lcywgc2V0U3dpbWxhbmVzXSA9IHVzZVN0YXRlPEthbmJhblR5cGVzLlN3aW1sYW5lW10+KFtkYXRhLnN3aW1sYW5lc1swXV0pCiAgICBjb25zdCBbY2FyZCwgc2V0Q2FyZF0gPSB1c2VTdGF0ZTxhbnk+KHt9KQogICAgY29uc3QgeyBzZXREaWFsb2csIGNsb3NlRGlhbG9nIH0gPSB1c2VEaWFsb2coKQoKICAgIGNvbnN0IGhhbmRsZUNhcmRNb3ZlID0gKHsgb3JpZ2luLCB0YXJnZXQgfSwgc2VsZWN0aW9uOiBLYW5iYW5TZWxlY3Rpb25bXSkgPT4gewogICAgICAgIGthbmJhblN0YXRlKHsgc3dpbWxhbmVzLCBzZXRTd2ltbGFuZXMsIGNhcmQsIHNldENhcmQgfSkuaGFuZGxlQ2FyZE1vdmUoeyBvcmlnaW4sIHRhcmdldCB9LCBzZWxlY3Rpb24pCiAgICB9CgogICAgY29uc3QgaGFuZGxlQ29sdW1uTW92ZSA9ICh7IG9yaWdpbiwgdGFyZ2V0IH0pID0+IHsKICAgICAgICBrYW5iYW5TdGF0ZSh7IHN3aW1sYW5lcywgc2V0U3dpbWxhbmVzLCBjYXJkLCBzZXRDYXJkIH0pLmhhbmRsZUNvbHVtbk1vdmUoeyBvcmlnaW4sIHRhcmdldCB9KQogICAgfQoKICAgIGNvbnN0IGhhbmRsZVN3aW1sYW5lTW92ZSA9ICh7IG9yaWdpbiwgdGFyZ2V0IH0pID0+IHsKICAgICAgICBrYW5iYW5TdGF0ZSh7IHN3aW1sYW5lcywgc2V0U3dpbWxhbmVzLCBjYXJkLCBzZXRDYXJkIH0pLmhhbmRsZVN3aW1sYW5lTW92ZSh7IG9yaWdpbiwgdGFyZ2V0IH0pCiAgICB9CgogICAgY29uc3QgaGFuZGxlQ2FyZE9wZW4gPSAoY2FyZCkgPT4gewogICAgICAgIGthbmJhblN0YXRlKHsgc3dpbWxhbmVzLCBzZXRTd2ltbGFuZXMsIGNhcmQsIHNldENhcmQgfSkuaGFuZGxlQ2FyZE9wZW4oY2FyZCkKICAgIH0KCiAgICBjb25zdCBoYW5kbGVDYXJkQWRkID0gKHsgdmFsdWUsIHN3aW1sYW5lSW5kZXgsIGNvbHVtbkluZGV4IH0pID0+IHsKICAgICAgICBrYW5iYW5TdGF0ZSh7IHN3aW1sYW5lcywgc2V0U3dpbWxhbmVzLCBjYXJkLCBzZXRDYXJkIH0pLmhhbmRsZUNhcmRBZGQoeyB2YWx1ZSwgc3dpbWxhbmVJbmRleCwgY29sdW1uSW5kZXggfSkKICAgIH0KCiAgICBjb25zdCBoYW5kbGVDYXJkVXBkYXRlID0gKGNhKSA9PiB7CiAgICAgICAga2FuYmFuU3RhdGUoeyBzd2ltbGFuZXMsIHNldFN3aW1sYW5lcywgY2FyZCwgc2V0Q2FyZCB9KS5oYW5kbGVDYXJkVXBkYXRlKGNhKQogICAgfQoKICAgIGNvbnN0IGhhbmRsZUNhcmREZWxldGUgPSAoY2EpID0+IHsKICAgICAgICBzZXREaWFsb2coewogICAgICAgICAgICB0aXRsZTogJ0FyZSB5b3Ugc3VyZT8nLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1RoaXMgYWN0aW9uIGNhbm5vdCBiZSB1bmRvbmUuJywKICAgICAgICAgICAgZm9vdGVyOiAoCiAgICAgICAgICAgICAgICA8VmlldwogICAgICAgICAgICAgICAgICAgIHJvdwogICAgICAgICAgICAgICAgICAgIHdpZHRoPSIxMDAlIgogICAgICAgICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50PSJzcGFjZS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2Nsb3NlRGlhbG9nfT5DYW5jZWw8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8QnV0dG9uCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGthbmJhblN0YXRlKHsgc3dpbWxhbmVzLCBzZXRTd2ltbGFuZXMsIGNhcmQsIHNldENhcmQgfSkuaGFuZGxlQ2FyZERlbGV0ZShjYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlRGlhbG9nKCkKICAgICAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFudD0iZGFuZ2VyIj4KICAgICAgICAgICAgICAgICAgICAgICAgRGVsZXRlCiAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICAgICAgICA8L1ZpZXc+CiAgICAgICAgICAgICksCiAgICAgICAgfSkKICAgIH0KCiAgICBjb25zdCBoYW5kbGVDb2x1bW5BZGQgPSAoeyB2YWx1ZSwgc3dpbWxhbmVJbmRleCB9KSA9PiB7CiAgICAgICAga2FuYmFuU3RhdGUoeyBzd2ltbGFuZXMsIHNldFN3aW1sYW5lcywgY2FyZCwgc2V0Q2FyZCB9KS5oYW5kbGVDb2x1bW5BZGQoeyB2YWx1ZSwgc3dpbWxhbmVJbmRleCB9KQogICAgfQoKICAgIGNvbnN0IGhhbmRsZUNvbHVtblVwZGF0ZSA9IChjb2wpID0+IHsKICAgICAgICBrYW5iYW5TdGF0ZSh7IHN3aW1sYW5lcywgc2V0U3dpbWxhbmVzLCBjYXJkLCBzZXRDYXJkIH0pLmhhbmRsZUNvbHVtblVwZGF0ZShjb2wpCiAgICB9CgogICAgY29uc3QgaGFuZGxlQ29sdW1uRGVsZXRlID0gKGNvbCkgPT4gewogICAgICAgIGthbmJhblN0YXRlKHsgc3dpbWxhbmVzLCBzZXRTd2ltbGFuZXMsIGNhcmQsIHNldENhcmQgfSkuaGFuZGxlQ29sdW1uRGVsZXRlKGNvbCkKICAgIH0KCiAgICBjb25zdCBoYW5kbGVTd2ltbGFuZVVwZGF0ZSA9IChzbCkgPT4gewogICAgICAgIGthbmJhblN0YXRlKHsgc3dpbWxhbmVzLCBzZXRTd2ltbGFuZXMsIGNhcmQsIHNldENhcmQgfSkuaGFuZGxlU3dpbWxhbmVVcGRhdGUoc2wpCiAgICB9CgogICAgY29uc3QgaGFuZGxlU3dpbWxhbmVEZWxldGUgPSAoc2wpID0+IHsKICAgICAgICBrYW5iYW5TdGF0ZSh7IHN3aW1sYW5lcywgc2V0U3dpbWxhbmVzLCBjYXJkLCBzZXRDYXJkIH0pLmhhbmRsZVN3aW1sYW5lRGVsZXRlKHNsKQogICAgfQoKICAgIGNvbnN0IGdldE1lbnUgPSAoeyBkYXRhOiB7IHRhcmdldCwgcGF5bG9hZCB9LCBkaXNtaXNzIH0pID0+IHsKICAgICAgICBzd2l0Y2ggKHRhcmdldCkgewogICAgICAgICAgICBjYXNlICdrYW5iYW4tbGFiZWwnOgogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICA8TGFiZWxNZW51CiAgICAgICAgICAgICAgICAgICAgICAgIG9uRmlsdGVyPXsodmFsdWUpID0+IGNvbnNvbGUubG9nKCdmaWx0ZXInLCB2YWx1ZSl9CiAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZUxhYmVscz17ZGF0YS5hdmFpbGFibGVMYWJlbHN9CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVscz17cGF5bG9hZC5sYWJlbHN9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsPXtkaXNtaXNzfQogICAgICAgICAgICAgICAgICAgICAgICBvblNhdmU9eyhsYWJlbHMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUNhcmRVcGRhdGUoeyAuLi5wYXlsb2FkLCBsYWJlbHMgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc21pc3MoKQogICAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgJ2thbmJhbi11c2VyJzoKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgPFVzZXJNZW51CiAgICAgICAgICAgICAgICAgICAgICAgIG9uRmlsdGVyPXsodmFsdWUpID0+IGNvbnNvbGUubG9nKCdmaWx0ZXInLCB2YWx1ZSl9CiAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZVVzZXJzPXtkYXRhLmF2YWlsYWJsZVVzZXJzfQogICAgICAgICAgICAgICAgICAgICAgICB1c2Vycz17cGF5bG9hZC51c2Vyc30KICAgICAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw9e2Rpc21pc3N9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uU2F2ZT17KHVzZXJzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVDYXJkVXBkYXRlKHsgLi4ucGF5bG9hZCwgdXNlcnMgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc21pc3MoKQogICAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgJ2thbmJhbi1tZW51JzoKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgPFBvcHVwCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yUGFsZXR0ZT17ZGF0YS5jb2xvclBhbGV0dGV9CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW09e3BheWxvYWR9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsPXtkaXNtaXNzfQogICAgICAgICAgICAgICAgICAgICAgICBvblNhdmU9eyhjYXJkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNtaXNzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUNhcmRVcGRhdGUoeyAuLi5wYXlsb2FkLCAuLi5jYXJkIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgICAgIG9uVmlldz17KCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzbWlzcygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDYXJkKHBheWxvYWQpCiAgICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlPXsoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNtaXNzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUNhcmREZWxldGUocGF5bG9hZCkKICAgICAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlICdrYW5iYW4tY29sdW1uJzoKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgICAgPEthbmJhbkNvbHVtbk1lbnUKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JQYWxldHRlPXtkYXRhLmNvbG9yUGFsZXR0ZX0KICAgICAgICAgICAgICAgICAgICAgICAgb25TYXZlPXsoY29sdW1uKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVDb2x1bW5VcGRhdGUoeyAuLi5wYXlsb2FkLCAuLi5jb2x1bW4gfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc21pc3MoKQogICAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZT17KCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQ29sdW1uRGVsZXRlKHBheWxvYWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNtaXNzKCkKICAgICAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uPXtwYXlsb2FkfQogICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgJ2thbmJhbi1zd2ltbGFuZSc6CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgIDxLYW5iYW5Td2ltbGFuZU1lbnUKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JQYWxldHRlPXtkYXRhLmNvbG9yUGFsZXR0ZX0KICAgICAgICAgICAgICAgICAgICAgICAgb25TYXZlPXsoc3dpbWxhbmUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVN3aW1sYW5lVXBkYXRlKHsgLi4ucGF5bG9hZCwgLi4uc3dpbWxhbmUgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc21pc3MoKQogICAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZT17KCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlU3dpbWxhbmVEZWxldGUocGF5bG9hZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc21pc3MoKQogICAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgICAgICBzd2ltbGFuZT17cGF5bG9hZH0KICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICgKICAgICAgICA8VmlldwogICAgICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgICAgaGVpZ2h0PXs3MDB9PgogICAgICAgICAgICB7ISFjYXJkLmlkICYmICgKICAgICAgICAgICAgICAgIDxEZXRhaWwKICAgICAgICAgICAgICAgICAgICBjb2xvclBhbGV0dGU9e2RhdGEuY29sb3JQYWxldHRlfQogICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZUxhYmVscz17ZGF0YS5hdmFpbGFibGVMYWJlbHN9CiAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlVXNlcnM9e2RhdGEuYXZhaWxhYmxlVXNlcnN9CiAgICAgICAgICAgICAgICAgICAgaXRlbT17Y2FyZH0KICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbD17KCkgPT4gc2V0Q2FyZCh7fSl9CiAgICAgICAgICAgICAgICAgICAgb25TYXZlPXsoY2FyZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVDYXJkVXBkYXRlKGNhcmQpCiAgICAgICAgICAgICAgICAgICAgICAgIHNldENhcmQoe30pCiAgICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgICBvbkRlbGV0ZT17KGNhcmQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQ2FyZERlbGV0ZShjYXJkKQogICAgICAgICAgICAgICAgICAgICAgICBzZXRDYXJkKHt9KQogICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICApfQoKICAgICAgICAgICAgPE1lbnVQcm92aWRlciBtZW51PXtnZXRNZW51fT4KICAgICAgICAgICAgICAgIDxLYW5iYW4KICAgICAgICAgICAgICAgICAgICBpZD0ia2FuYmFuLWluc3RhbmNlLTEiCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgJy0tZi1rYW5iYW4tc3dpbWxhbmUtbWluaGVpZ2h0JzogJzEwMCUnIH19CiAgICAgICAgICAgICAgICAgICAgc3dpbWxhbmVzPXtzd2ltbGFuZXN9CiAgICAgICAgICAgICAgICAgICAgb25DYXJkT3Blbj17aGFuZGxlQ2FyZE9wZW59CiAgICAgICAgICAgICAgICAgICAgb25DYXJkQWRkPXtoYW5kbGVDYXJkQWRkfQogICAgICAgICAgICAgICAgICAgIG9uQ2FyZFVwZGF0ZT17aGFuZGxlQ2FyZFVwZGF0ZX0KICAgICAgICAgICAgICAgICAgICBvbkNhcmRNb3ZlPXtoYW5kbGVDYXJkTW92ZX0KICAgICAgICAgICAgICAgICAgICBvbkNvbHVtbkFkZD17aGFuZGxlQ29sdW1uQWRkfQogICAgICAgICAgICAgICAgICAgIG9uQ29sdW1uTW92ZT17aGFuZGxlQ29sdW1uTW92ZX0KICAgICAgICAgICAgICAgICAgICBvblN3aW1sYW5lTW92ZT17aGFuZGxlU3dpbWxhbmVNb3ZlfQogICAgICAgICAgICAgICAgICAgIG9uQ29sdW1uVXBkYXRlPXtoYW5kbGVDb2x1bW5VcGRhdGV9CiAgICAgICAgICAgICAgICAgICAgb25Td2ltbGFuZVVwZGF0ZT17aGFuZGxlU3dpbWxhbmVVcGRhdGV9CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEludGVyYWN0aW9uPSJhbmltYXRlZCIKICAgICAgICAgICAgICAgICAgICB0YXJnZXRWYXJpYW50PXt7ICdwcm9qZWN0cyc6ICdmb2N1cycgfX0KICAgICAgICAgICAgICAgICAgICBjYXJkPXt1bmRlZmluZWR9CiAgICAgICAgICAgICAgICAgICAgY29sdW1uSGVhZGVyPXt1bmRlZmluZWR9CiAgICAgICAgICAgICAgICAgICAgc3dpbWxhbmVIZWFkZXI9e3VuZGVmaW5lZH0KICAgICAgICAgICAgICAgICAgICB0b29sYmFyPXsoeyBzZWxlY3Rpb24gfSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPFZpZXcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbj0iZml4ZWQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmdUb2tlbj0ic3VyZmFjZS1pbnZlcnNlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yVG9rZW49InRleHQtb24tY29sb3IiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcD0iMXJlbSAycmVtIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhZGl1cz0idmFyKC0tZi1yYWRpdXMpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYWRvdz0idmFyKC0tZi1zaGFkb3cteGwpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleD17MTAwMH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXA9ezEwfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iZi1mYWRlaW4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheT17IU9iamVjdC5rZXlzKHNlbGVjdGlvbikubGVuZ3RoID8gJ25vbmUnIDogJ2ZsZXgnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IGJvdHRvbTogMTAsIGxlZnQ6ICc1MCUnLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKC01MCUpJyB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCBjb2xvcj0iaW5oZXJpdCI+e09iamVjdC5rZXlzKHNlbGVjdGlvbikubGVuZ3RofSBzZWxlY3RlZDwvVGV4dD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SWNvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uPXtGSUJpbn0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJmLWJ1dHRvbml6ZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0RGlhbG9nKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FyZSB5b3Ugc3VyZT8nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGhpcyBhY3Rpb24gY2Fubm90IGJlIHVuZG9uZS4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcnRhbDogUG9ydGFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RlcjogKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VmlldwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg9IjEwMCUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50PSJzcGFjZS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlRGlhbG9nKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hLYW5iYW5FdmVudCgnc2VsZWN0JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZDogJ2thbmJhbi1pbnN0YW5jZS0xJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW5jZWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9ImRhbmdlciIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGthbmJhblN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aW1sYW5lcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFN3aW1sYW5lcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDYXJkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5oYW5kbGVTZWxlY3Rpb25EZWxldGUoc2VsZWN0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEthbmJhbkV2ZW50KCdzZWxlY3QnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkOiAna2FuYmFuLWluc3RhbmNlLTEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZURpYWxvZygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVsZXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9WaWV3PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1ZpZXc+CiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9NZW51UHJvdmlkZXI+CiAgICAgICAgPC9WaWV3PgogICAgKQp9" />

```tsx
export const Usage = () => {
    const [swimlanes, setSwimlanes] = useState<KanbanTypes.Swimlane[]>([data.swimlanes[0]])
    const [card, setCard] = useState<any>({})
    const { setDialog, closeDialog } = useDialog()

    const handleCardMove = ({ origin, target }, selection: KanbanSelection[]) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardMove({ origin, target }, selection)
    }

    const handleColumnMove = ({ origin, target }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnMove({ origin, target })
    }

    const handleSwimlaneMove = ({ origin, target }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleSwimlaneMove({ origin, target })
    }

    const handleCardOpen = (card) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardOpen(card)
    }

    const handleCardAdd = ({ value, swimlaneIndex, columnIndex }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardAdd({ value, swimlaneIndex, columnIndex })
    }

    const handleCardUpdate = (ca) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardUpdate(ca)
    }

    const handleCardDelete = (ca) => {
        setDialog({
            title: 'Are you sure?',
            description: 'This action cannot be undone.',
            footer: (
                <View
                    row
                    width="100%"
                    justifyContent="space-between">
                    <Button onClick={closeDialog}>Cancel</Button>
                    <Button
                        onClick={() => {
                            kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleCardDelete(ca)
                            closeDialog()
                        }}
                        variant="danger">
                        Delete
                    </Button>
                </View>
            ),
        })
    }

    const handleColumnAdd = ({ value, swimlaneIndex }) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnAdd({ value, swimlaneIndex })
    }

    const handleColumnUpdate = (col) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnUpdate(col)
    }

    const handleColumnDelete = (col) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleColumnDelete(col)
    }

    const handleSwimlaneUpdate = (sl) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleSwimlaneUpdate(sl)
    }

    const handleSwimlaneDelete = (sl) => {
        kanbanState({ swimlanes, setSwimlanes, card, setCard }).handleSwimlaneDelete(sl)
    }

    const getMenu = ({ data: { target, payload }, dismiss }) => {
        switch (target) {
            case 'kanban-label':
                return (
                    <LabelMenu
                        onFilter={(value) => console.log('filter', value)}
                        availableLabels={data.availableLabels}
                        labels={payload.labels}
                        onCancel={dismiss}
                        onSave={(labels) => {
                            handleCardUpdate({ ...payload, labels })
                            dismiss()
                        }}
                    />
                )
            case 'kanban-user':
                return (
                    <UserMenu
                        onFilter={(value) => console.log('filter', value)}
                        availableUsers={data.availableUsers}
                        users={payload.users}
                        onCancel={dismiss}
                        onSave={(users) => {
                            handleCardUpdate({ ...payload, users })
                            dismiss()
                        }}
                    />
                )
            case 'kanban-menu':
                return (
                    <Popup
                        colorPalette={data.colorPalette}
                        item={payload}
                        onCancel={dismiss}
                        onSave={(card) => {
                            dismiss()
                            handleCardUpdate({ ...payload, ...card })
                        }}
                        onView={() => {
                            dismiss()
                            setCard(payload)
                        }}
                        onDelete={() => {
                            dismiss()
                            handleCardDelete(payload)
                        }}
                    />
                )
            case 'kanban-column':
                return (
                    <KanbanColumnMenu
                        colorPalette={data.colorPalette}
                        onSave={(column) => {
                            handleColumnUpdate({ ...payload, ...column })
                            dismiss()
                        }}
                        onDelete={() => {
                            handleColumnDelete(payload)
                            dismiss()
                        }}
                        column={payload}
                    />
                )
            case 'kanban-swimlane':
                return (
                    <KanbanSwimlaneMenu
                        colorPalette={data.colorPalette}
                        onSave={(swimlane) => {
                            handleSwimlaneUpdate({ ...payload, ...swimlane })
                            dismiss()
                        }}
                        onDelete={() => {
                            handleSwimlaneDelete(payload)
                            dismiss()
                        }}
                        swimlane={payload}
                    />
                )
            default:
                return null
        }
    }

    return (
        <View
            width="100%"
            height={700}>
            {!!card.id && (
                <Detail
                    colorPalette={data.colorPalette}
                    availableLabels={data.availableLabels}
                    availableUsers={data.availableUsers}
                    item={card}
                    onCancel={() => setCard({})}
                    onSave={(card) => {
                        handleCardUpdate(card)
                        setCard({})
                    }}
                    onDelete={(card) => {
                        handleCardDelete(card)
                        setCard({})
                    }}
                />
            )}

            <MenuProvider menu={getMenu}>
                <Kanban
                    id="kanban-instance-1"
                    
                    style={{ '--f-kanban-swimlane-minheight': '100%' }}
                    swimlanes={swimlanes}
                    onCardOpen={handleCardOpen}
                    onCardAdd={handleCardAdd}
                    onCardUpdate={handleCardUpdate}
                    onCardMove={handleCardMove}
                    onColumnAdd={handleColumnAdd}
                    onColumnMove={handleColumnMove}
                    onSwimlaneMove={handleSwimlaneMove}
                    onColumnUpdate={handleColumnUpdate}
                    onSwimlaneUpdate={handleSwimlaneUpdate}
                    defaultInteraction="animated"
                    targetVariant={{ 'projects': 'focus' }}
                    card={undefined}
                    columnHeader={undefined}
                    swimlaneHeader={undefined}
                    toolbar={({ selection }) => {
                        return (
                            <View
                                row
                                position="fixed"
                                bgToken="surface-inverse"
                                colorToken="text-on-color"
                                p="1rem 2rem"
                                radius="var(--f-radius)"
                                shadow="var(--f-shadow-xl)"
                                zIndex={1000}
                                gap={10}
                                className="f-fadein"
                                display={!Object.keys(selection).length ? 'none' : 'flex'}
                                style={{ bottom: 10, left: '50%', transform: 'translateX(-50%)' }}>
                                <Text color="inherit">{Object.keys(selection).length} selected</Text>
                                <Icon
                                    icon={FIBin}
                                    className="f-buttonize"
                                    onClick={() => {
                                        setDialog({
                                            title: 'Are you sure?',
                                            description: 'This action cannot be undone.',
                                            portal: Portal,
                                            footer: (
                                                <View
                                                    width="100%"
                                                    row
                                                    justifyContent="space-between">
                                                    <Button
                                                        onClick={() => {
                                                            closeDialog()
                                                            dispatchKanbanEvent('select', {
                                                                instanceId: 'kanban-instance-1',
                                                            })
                                                        }}>
                                                        Cancel
                                                    </Button>
                                                    <Button
                                                        variant="danger"
                                                        onClick={() => {
                                                            kanbanState({
                                                                swimlanes,
                                                                setSwimlanes,
                                                                card,
                                                                setCard,
                                                            }).handleSelectionDelete(selection)
                                                            dispatchKanbanEvent('select', {
                                                                instanceId: 'kanban-instance-1',
                                                            })
                                                            closeDialog()
                                                        }}>
                                                        Delete
                                                    </Button>
                                                </View>
                                            ),
                                        })
                                    }}
                                />
                            </View>
                        )
                    }}
                />
            </MenuProvider>
        </View>
    )
}
```

export default ({ children }) => <ComponentLayout docs={docs} props={props} css={css}>{children}</ComponentLayout>